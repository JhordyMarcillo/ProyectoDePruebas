"use strict";(self.webpackChunkspa_modern_frontend=self.webpackChunkspa_modern_frontend||[]).push([[317],{5317:(Z,p,s)=>{s.r(p),s.d(p,{VentasModule:()=>Q});var d=s(177),c=s(9417),g=s(9012),h=s(9159),_=s(8834),v=s(9213),f=s(6467),b=s(9631),C=s(2798),V=s(5351),M=s(5416),F=s(5596),x=s(9183),E=s(4823),j=s(6471),e=s(4438),u=s(6354),m=s(5312),P=s(1626);let k=(()=>{class i{constructor(t){this.http=t,this.apiUrl=`${m.c.apiUrl}/ventas`}getVentas(){return this.http.get(`${this.apiUrl}?limit=1000`).pipe((0,u.T)(t=>t.data||[]))}getVenta(t){return this.http.get(`${this.apiUrl}/${t}`).pipe((0,u.T)(n=>n.data))}createVenta(t){return this.http.post(this.apiUrl,t).pipe((0,u.T)(n=>n.data))}updateVenta(t,n){return this.http.put(`${this.apiUrl}/${t}`,n).pipe((0,u.T)(o=>o.data))}deleteVenta(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe((0,u.T)(()=>{}))}generarFactura(t){window.open(`${m.c.apiUrl}/ventas/${t}/factura`,"_blank","width=800,height=600,scrollbars=yes,resizable=yes")}static{this.\u0275fac=function(n){return new(n||i)(e.KVO(P.Qq))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var S=s(551),O=s(9525),T=s(6477),R=s(8010);function I(i,r){if(1&i&&(e.j41(0,"div",6),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.Y8G("ngClass",t.messageType),e.R7$(),e.SpI(" ",t.message," ")}}function G(i,r){1&i&&(e.j41(0,"div",14),e.EFF(1,"Cargando ventas..."),e.k0s())}function $(i,r){if(1&i&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.JRh(t.error)}}function y(i,r){if(1&i){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td")(14,"span",18),e.EFF(15),e.k0s()(),e.j41(16,"td")(17,"button",19),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.editarVenta(o))}),e.EFF(18," Editar "),e.k0s(),e.j41(19,"button",20),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.generarFactura(o))}),e.EFF(20," Factura "),e.k0s(),e.j41(21,"button",21),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.eliminarVenta(o))}),e.EFF(22," Eliminar "),e.k0s()()()}if(2&i){const t=r.$implicit,n=e.XpG(3);e.R7$(2),e.JRh(t.id),e.R7$(2),e.JRh(n.getClienteNombre(t.cedula_cliente)),e.R7$(2),e.JRh(t.vendedor),e.R7$(2),e.JRh(n.formatMoney(t.total_pagar)),e.R7$(2),e.JRh(t.metodo||"N/A"),e.R7$(2),e.JRh(n.formatDate(t.fecha_creacion)),e.R7$(2),e.Y8G("ngClass",t.estado),e.R7$(),e.SpI(" ",t.estado," ")}}function N(i,r){if(1&i&&(e.j41(0,"table",16)(1,"thead")(2,"tr")(3,"th"),e.EFF(4,"ID"),e.k0s(),e.j41(5,"th"),e.EFF(6,"Cliente"),e.k0s(),e.j41(7,"th"),e.EFF(8,"Vendedor"),e.k0s(),e.j41(9,"th"),e.EFF(10,"Total"),e.k0s(),e.j41(11,"th"),e.EFF(12,"M\xe9todo"),e.k0s(),e.j41(13,"th"),e.EFF(14,"Fecha"),e.k0s(),e.j41(15,"th"),e.EFF(16,"Estado"),e.k0s(),e.j41(17,"th"),e.EFF(18,"Acciones"),e.k0s()()(),e.j41(19,"tbody"),e.DNE(20,y,23,8,"tr",17),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(20),e.Y8G("ngForOf",t.ventas)}}function A(i,r){1&i&&(e.j41(0,"div",22),e.EFF(1," No hay ventas registradas "),e.k0s())}function L(i,r){if(1&i&&(e.j41(0,"section",7)(1,"div",8)(2,"h2"),e.EFF(3,"Listado de Ventas"),e.k0s(),e.j41(4,"div",9),e.DNE(5,G,2,0,"div",10)(6,$,2,1,"div",11)(7,N,21,1,"table",12)(8,A,2,0,"div",13),e.k0s()()()),2&i){const t=e.XpG();e.R7$(5),e.Y8G("ngIf",t.loading),e.R7$(),e.Y8G("ngIf",t.error),e.R7$(),e.Y8G("ngIf",!t.loading&&!t.error),e.R7$(),e.Y8G("ngIf",!t.loading&&!t.error&&0===t.ventas.length)}}function D(i,r){if(1&i&&(e.j41(0,"option",47),e.EFF(1),e.k0s()),2&i){const t=r.$implicit;e.Y8G("value",t.id),e.R7$(),e.E5c(" ",t.nombre_producto," - $",t.precio_producto," (Stock: ",t.cantidad_producto,") ")}}function X(i,r){if(1&i){const t=e.RV6();e.j41(0,"li"),e.EFF(1),e.j41(2,"button",49),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG(3);return e.Njj(a.eliminarProducto(o))}),e.EFF(3,"Eliminar"),e.k0s()()}if(2&i){const t=r.$implicit;e.R7$(),e.LHq(" ",t.nombre," - Cantidad: ",t.cantidad," - $",t.costo," c/u = $",(t.costo*t.cantidad).toFixed(2)," ")}}function w(i,r){if(1&i&&(e.j41(0,"div")(1,"h3"),e.EFF(2,"Productos A\xf1adidos"),e.k0s(),e.j41(3,"ul",48),e.DNE(4,X,4,4,"li",17),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.Y8G("ngForOf",t.nuevaVenta.productos)}}function Y(i,r){if(1&i&&(e.j41(0,"option",47),e.EFF(1),e.k0s()),2&i){const t=r.$implicit;e.Y8G("value",t.id),e.R7$(),e.Lme(" ",t.nombre," - $",t.coste_total," ")}}function B(i,r){if(1&i){const t=e.RV6();e.j41(0,"li"),e.EFF(1),e.j41(2,"button",49),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG(3);return e.Njj(a.eliminarServicio(o))}),e.EFF(3,"Eliminar"),e.k0s()()}if(2&i){const t=r.$implicit;e.R7$(),e.LHq(" ",t.nombre," - Cantidad: ",t.cantidad," - $",t.costo," c/u = $",(t.costo*t.cantidad).toFixed(2)," ")}}function U(i,r){if(1&i&&(e.j41(0,"div")(1,"h3"),e.EFF(2,"Servicios A\xf1adidos"),e.k0s(),e.j41(3,"ul",48),e.DNE(4,B,4,4,"li",17),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.Y8G("ngForOf",t.nuevaVenta.servicios)}}function z(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",29)(1,"div",26)(2,"input",50),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG(2);return e.DH7(a.montoEntregado,o)||(a.montoEntregado=o),e.Njj(o)}),e.bIt("ngModelChange",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.onMontoEntregadoChange())}),e.k0s(),e.j41(3,"label"),e.EFF(4,"Monto Entregado:"),e.k0s()(),e.j41(5,"div",26),e.nrm(6,"input",40),e.j41(7,"label"),e.EFF(8,"Cambio:"),e.k0s()()()}if(2&i){const t=e.XpG(2);e.R7$(2),e.R50("ngModel",t.montoEntregado),e.R7$(4),e.Y8G("value",t.cambio.toFixed(2))}}function H(i,r){if(1&i){const t=e.RV6();e.j41(0,"section",7)(1,"div",23)(2,"h1",24),e.EFF(3),e.k0s(),e.j41(4,"form",25,0),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.guardarVenta())}),e.j41(6,"div",26)(7,"input",27),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.buscarClienteInput,o)||(a.buscarClienteInput=o),e.Njj(o)}),e.bIt("input",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onCedulaInput())})("keyup.enter",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.buscarCliente())})("blur",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.buscarCliente())}),e.k0s(),e.j41(8,"button",28),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.buscarCliente())}),e.EFF(9,"Buscar Cliente"),e.k0s()(),e.j41(10,"h3"),e.EFF(11,"Datos del Cliente"),e.k0s(),e.j41(12,"div",29)(13,"div",26),e.nrm(14,"input",30),e.j41(15,"label"),e.EFF(16,"Nombre:"),e.k0s()(),e.j41(17,"div",26),e.nrm(18,"input",30),e.j41(19,"label"),e.EFF(20,"Apellido:"),e.k0s()()(),e.j41(21,"div",29)(22,"div",26),e.nrm(23,"input",30),e.j41(24,"label"),e.EFF(25,"C\xe9dula:"),e.k0s()(),e.j41(26,"div",26),e.nrm(27,"input",30),e.j41(28,"label"),e.EFF(29,"N\xfamero:"),e.k0s()()(),e.j41(30,"div",29)(31,"div",26),e.nrm(32,"input",31),e.j41(33,"label"),e.EFF(34,"Email:"),e.k0s()(),e.j41(35,"div",26),e.nrm(36,"input",30),e.j41(37,"label"),e.EFF(38,"Locaci\xf3n:"),e.k0s()()(),e.j41(39,"h3"),e.EFF(40,"Facturaci\xf3n"),e.k0s(),e.j41(41,"div",29)(42,"div",26)(43,"select",32),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.productoSeleccionado,o)||(a.productoSeleccionado=o),e.Njj(o)}),e.j41(44,"option",33),e.EFF(45,"Seleccionar Producto"),e.k0s(),e.DNE(46,D,2,4,"option",34),e.k0s(),e.j41(47,"label"),e.EFF(48,"Producto:"),e.k0s()(),e.j41(49,"div",26)(50,"input",35),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.cantidadProducto,o)||(a.cantidadProducto=o),e.Njj(o)}),e.k0s(),e.j41(51,"label"),e.EFF(52,"Cantidad del Producto:"),e.k0s(),e.j41(53,"button",28),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.agregarProducto())}),e.EFF(54,"A\xf1adir Producto"),e.k0s()()(),e.DNE(55,w,5,1,"div",36),e.j41(56,"div",29)(57,"div",26)(58,"select",37),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.servicioSeleccionado,o)||(a.servicioSeleccionado=o),e.Njj(o)}),e.j41(59,"option",33),e.EFF(60,"Seleccionar Servicio"),e.k0s(),e.DNE(61,Y,2,3,"option",34),e.k0s(),e.j41(62,"label"),e.EFF(63,"Servicio:"),e.k0s()(),e.j41(64,"div",26)(65,"input",38),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.cantidadServicio,o)||(a.cantidadServicio=o),e.Njj(o)}),e.k0s(),e.j41(66,"label"),e.EFF(67,"Cantidad de Servicios:"),e.k0s(),e.j41(68,"button",28),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.agregarServicio())}),e.EFF(69,"A\xf1adir Servicio"),e.k0s()()(),e.DNE(70,U,5,1,"div",36),e.j41(71,"div",29)(72,"div",26)(73,"input",39),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.nuevaVenta.iva,o)||(a.nuevaVenta.iva=o),e.Njj(o)}),e.bIt("ngModelChange",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.calcularTotal())}),e.k0s(),e.j41(74,"label"),e.EFF(75,"IVA (%):"),e.k0s()(),e.j41(76,"div",26),e.nrm(77,"input",40),e.j41(78,"label"),e.EFF(79,"Total:"),e.k0s()()(),e.j41(80,"div",29)(81,"div",26)(82,"select",41),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.nuevaVenta.metodo,o)||(a.nuevaVenta.metodo=o),e.Njj(o)}),e.bIt("ngModelChange",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onMetodoChange())}),e.j41(83,"option",33),e.EFF(84,"Seleccionar M\xe9todo"),e.k0s(),e.j41(85,"option",42),e.EFF(86,"Efectivo"),e.k0s(),e.j41(87,"option",43),e.EFF(88,"Tarjeta de D\xe9bito"),e.k0s()(),e.j41(89,"label"),e.EFF(90,"M\xe9todo de Pago:"),e.k0s()()(),e.DNE(91,z,9,2,"div",44),e.j41(92,"h3"),e.EFF(93,"Datos del Vendedor"),e.k0s(),e.j41(94,"div",26)(95,"input",45),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.nuevaVenta.vendedor,o)||(a.nuevaVenta.vendedor=o),e.Njj(o)}),e.k0s(),e.j41(96,"label"),e.EFF(97,"Vendedor:"),e.k0s()(),e.j41(98,"button",46),e.EFF(99),e.k0s()()()()}if(2&i){const t=e.sdS(5),n=e.XpG();e.R7$(3),e.JRh(n.isEditing?"Editar Venta":"Registro de Venta"),e.R7$(4),e.R50("ngModel",n.buscarClienteInput),e.R7$(7),e.Y8G("value",(null==n.clienteSeleccionado?null:n.clienteSeleccionado.nombre)||""),e.R7$(4),e.Y8G("value",(null==n.clienteSeleccionado?null:n.clienteSeleccionado.apellido)||""),e.R7$(5),e.Y8G("value",(null==n.clienteSeleccionado?null:n.clienteSeleccionado.cedula)||""),e.R7$(4),e.Y8G("value",(null==n.clienteSeleccionado?null:n.clienteSeleccionado.numero)||""),e.R7$(5),e.Y8G("value",(null==n.clienteSeleccionado?null:n.clienteSeleccionado.email)||""),e.R7$(4),e.Y8G("value",(null==n.clienteSeleccionado?null:n.clienteSeleccionado.locacion)||""),e.R7$(7),e.R50("ngModel",n.productoSeleccionado),e.R7$(3),e.Y8G("ngForOf",n.productos),e.R7$(4),e.R50("ngModel",n.cantidadProducto),e.R7$(5),e.Y8G("ngIf",n.nuevaVenta.productos.length>0),e.R7$(3),e.R50("ngModel",n.servicioSeleccionado),e.R7$(3),e.Y8G("ngForOf",n.servicios),e.R7$(4),e.R50("ngModel",n.cantidadServicio),e.R7$(5),e.Y8G("ngIf",n.nuevaVenta.servicios.length>0),e.R7$(3),e.R50("ngModel",n.nuevaVenta.iva),e.R7$(4),e.Y8G("value",n.nuevaVenta.total_pagar.toFixed(2)),e.R7$(5),e.R50("ngModel",n.nuevaVenta.metodo),e.R7$(9),e.Y8G("ngIf","efectivo"===n.nuevaVenta.metodo),e.R7$(4),e.R50("ngModel",n.nuevaVenta.vendedor),e.R7$(3),e.Y8G("disabled",!t.form.valid),e.R7$(),e.SpI(" ",n.isEditing?"Actualizar Venta":"Guardar Venta"," ")}}const J=[{path:"",component:(()=>{class i{constructor(t,n,o,a,l,K){this.router=t,this.ventasService=n,this.clientesService=o,this.productosService=a,this.serviciosService=l,this.authService=K,this.ventas=[],this.clientes=[],this.productos=[],this.servicios=[],this.loading=!1,this.error=null,this.activeTab="list",this.isEditing=!1,this.editingVentaId=null,this.message="",this.messageType="",this.nuevaVenta={cedula_cliente:"",productos:[],servicios:[],iva:15,total_pagar:0,metodo:"",vendedor:"",estado:"activo"},this.clienteSeleccionado=null,this.buscarClienteInput="",this.productoSeleccionado="",this.cantidadProducto=1,this.servicioSeleccionado="",this.cantidadServicio=1,this.montoEntregado=0,this.cambio=0}ngOnInit(){this.loadVentas(),this.loadClientes(),this.loadProductos(),this.loadServicios(),this.loadUserInfo()}loadVentas(){console.log("=== INICIANDO CARGA DE VENTAS ==="),this.loading=!0,this.error=null,this.ventasService.getVentas().subscribe({next:t=>{console.log("=== VENTAS RECIBIDAS ==="),console.log("N\xfamero de ventas:",t.length),console.log("Datos de ventas:",t),this.ventas=t,this.loading=!1},error:t=>{console.error("=== ERROR AL CARGAR VENTAS ==="),console.error("Error completo:",t),this.error="Error al cargar la lista de ventas",this.loading=!1}})}loadClientes(){this.clientesService.getClientes().subscribe({next:t=>{console.log("=== CLIENTES CARGADOS PARA VENTAS ==="),console.log("Clientes recibidos:",t),this.clientes=Array.isArray(t)?t:[],console.log("Total clientes cargados:",this.clientes.length)},error:t=>{console.error("Error al cargar clientes:",t),this.clientes=[]}})}loadProductos(){this.productosService.getProductos().subscribe({next:t=>{console.log("=== PRODUCTOS CARGADOS PARA VENTAS ==="),console.log("Productos recibidos:",t),this.productos=t.filter(n=>"activo"===n.estado&&n.cantidad_producto>0),console.log("Productos con stock disponible:",this.productos)},error:t=>{console.error("Error al cargar productos:",t)}})}loadServicios(){this.serviciosService.getServicios().subscribe({next:t=>{this.servicios=t.servicios},error:t=>{console.error("Error al cargar servicios:",t)}})}loadUserInfo(){const t=this.authService.currentUserValue;this.nuevaVenta.vendedor=t&&t.nombre&&t.apellido?`${t.nombre} ${t.apellido}`:"admin admin"}setActiveTab(t){console.log("=== CAMBIANDO PESTA\xd1A ==="),console.log("Pesta\xf1a anterior:",this.activeTab),console.log("Nueva pesta\xf1a:",t),this.activeTab=t,"new"===t&&(this.resetForm(),this.isEditing=!1),console.log("Pesta\xf1a activa despu\xe9s del cambio:",this.activeTab)}resetForm(){const t=this.authService.currentUserValue;this.nuevaVenta={cedula_cliente:"",productos:[],servicios:[],iva:15,total_pagar:0,metodo:"",vendedor:t&&t.nombre&&t.apellido?`${t.nombre} ${t.apellido}`:"admin admin",estado:"activo"},this.clienteSeleccionado=null,this.buscarClienteInput="",this.productoSeleccionado="",this.cantidadProducto=1,this.servicioSeleccionado="",this.cantidadServicio=1,this.montoEntregado=0,this.cambio=0,this.message="",this.messageType=""}onCedulaInput(){this.buscarClienteInput.length>=8?this.buscarClienteAutomatico():(this.clienteSeleccionado=null,this.nuevaVenta.cedula_cliente="")}buscarClienteAutomatico(){const t=this.clientes.find(n=>n.cedula===this.buscarClienteInput.trim());t?(this.clienteSeleccionado=t,this.nuevaVenta.cedula_cliente=t.cedula,console.log("Cliente encontrado autom\xe1ticamente:",this.clienteSeleccionado)):(this.clienteSeleccionado=null,this.nuevaVenta.cedula_cliente="")}buscarCliente(){if(console.log("=== BUSCANDO CLIENTE ==="),console.log("C\xe9dula a buscar:",this.buscarClienteInput.trim()),!this.buscarClienteInput.trim())return void this.showMessage("error","Ingrese una c\xe9dula para buscar");const t=this.clientes.find(n=>n.cedula===this.buscarClienteInput.trim());console.log("Cliente encontrado:",t),console.log("Lista completa de clientes:",this.clientes),t?(this.clienteSeleccionado=t,this.nuevaVenta.cedula_cliente=t.cedula,console.log("Cliente seleccionado:",this.clienteSeleccionado),this.showMessage("success",`Cliente encontrado: ${t.nombre} ${t.apellido}`)):(this.showMessage("error","Cliente no encontrado con esa c\xe9dula"),this.clienteSeleccionado=null,this.nuevaVenta.cedula_cliente="")}agregarProducto(){if(!this.productoSeleccionado||this.cantidadProducto<=0)return void this.showMessage("error","Seleccione un producto y cantidad v\xe1lida");const t=this.productos.find(o=>o.id?.toString()===this.productoSeleccionado);t?t.cantidad_producto<this.cantidadProducto?this.showMessage("error","Stock insuficiente"):(this.nuevaVenta.productos.push({id:t.id,nombre:t.nombre_producto,cantidad:this.cantidadProducto,costo:t.precio_producto}),this.calcularTotal(),this.showMessage("success","Producto agregado"),this.productoSeleccionado="",this.cantidadProducto=1):this.showMessage("error","Producto no encontrado")}agregarServicio(){if(!this.servicioSeleccionado||this.cantidadServicio<=0)return void this.showMessage("error","Seleccione un servicio y cantidad v\xe1lida");const t=this.servicios.find(o=>o.id?.toString()===this.servicioSeleccionado);t?(this.nuevaVenta.servicios.push({id:t.id,nombre:t.nombre,cantidad:this.cantidadServicio,costo:t.coste_total}),this.calcularTotal(),this.showMessage("success","Servicio agregado"),this.servicioSeleccionado="",this.cantidadServicio=1):this.showMessage("error","Servicio no encontrado")}eliminarProducto(t){this.nuevaVenta.productos.splice(t,1),this.calcularTotal()}eliminarServicio(t){this.nuevaVenta.servicios.splice(t,1),this.calcularTotal()}calcularTotal(){let t=0;this.nuevaVenta.productos.forEach(o=>{t+=o.cantidad*o.costo}),this.nuevaVenta.servicios.forEach(o=>{t+=o.cantidad*o.costo}),this.nuevaVenta.total_pagar=t+t*this.nuevaVenta.iva/100}onMetodoChange(){"efectivo"!==this.nuevaVenta.metodo&&(this.montoEntregado=0,this.cambio=0)}onMontoEntregadoChange(){"efectivo"===this.nuevaVenta.metodo&&(this.cambio=this.montoEntregado-this.nuevaVenta.total_pagar,this.cambio<0&&this.showMessage("error","Efectivo insuficiente"))}guardarVenta(){if(!this.clienteSeleccionado)return void this.showMessage("error","Debe seleccionar un cliente");if(0===this.nuevaVenta.productos.length&&0===this.nuevaVenta.servicios.length)return void this.showMessage("error","Debe agregar al menos un producto o servicio");if(!this.nuevaVenta.metodo)return void this.showMessage("error","Debe seleccionar un m\xe9todo de pago");if("efectivo"===this.nuevaVenta.metodo&&this.cambio<0)return void this.showMessage("error","Efectivo insuficiente");const t={cedula_cliente:this.nuevaVenta.cedula_cliente,productos:this.nuevaVenta.productos,servicios:this.nuevaVenta.servicios,iva:this.nuevaVenta.iva,total_pagar:this.nuevaVenta.total_pagar,metodo:this.nuevaVenta.metodo,vendedor:this.nuevaVenta.vendedor,estado:this.nuevaVenta.estado};console.log("Guardando venta:",t),this.isEditing&&this.editingVentaId?this.ventasService.updateVenta(this.editingVentaId,t).subscribe({next:n=>{console.log("Venta actualizada:",n),this.showMessage("success","Venta actualizada exitosamente"),this.loadVentas(),this.setActiveTab("list")},error:n=>{console.error("Error al actualizar venta:",n),this.showMessage("error","Error al actualizar la venta")}}):this.ventasService.createVenta(t).subscribe({next:n=>{console.log("Venta creada:",n),this.showMessage("success","Venta registrada exitosamente"),this.loadVentas(),this.setActiveTab("list")},error:n=>{console.error("Error al crear venta:",n),this.showMessage("error","Error al registrar la venta")}})}editarVenta(t){this.isEditing=!0,this.editingVentaId=t.id,this.nuevaVenta={cedula_cliente:t.cedula_cliente,productos:Array.isArray(t.productos)?t.productos:[],servicios:Array.isArray(t.servicios)?t.servicios:[],iva:t.iva,total_pagar:t.total_pagar,metodo:t.metodo,vendedor:t.vendedor,estado:t.estado};const n=this.clientes.find(o=>o.cedula===t.cedula_cliente);n&&(this.clienteSeleccionado=n),this.buscarClienteInput=t.cedula_cliente,this.setActiveTab("edit")}eliminarVenta(t){confirm(`\xbfEst\xe1 seguro de eliminar la venta #${t.id}?`)&&this.ventasService.deleteVenta(t.id).subscribe({next:()=>{this.showMessage("success","Venta eliminada exitosamente"),this.loadVentas()},error:n=>{console.error("Error al eliminar venta:",n),this.showMessage("error","Error al eliminar la venta")}})}generarFactura(t){console.log("=== GENERANDO FACTURA ==="),console.log("Venta seleccionada:",t);try{this.ventasService.generarFactura(t.id),this.showMessage("success","Factura generada - se abrir\xe1 en una nueva ventana")}catch(n){console.error("Error al generar factura:",n),this.showMessage("error","Error al generar la factura")}}getClienteNombre(t){if(!this.clientes||!Array.isArray(this.clientes))return console.log("Clientes no est\xe1 inicializado como array:",this.clientes),t;const n=this.clientes.find(o=>o.cedula===t);return n?`${n.nombre} ${n.apellido}`:t}showMessage(t,n){this.messageType=t,this.message=n,setTimeout(()=>{this.message="",this.messageType=""},5e3)}formatDate(t){return new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}formatMoney(t){return new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(g.Ix),e.rXU(k),e.rXU(S.T),e.rXU(O.J),e.rXU(T.P),e.rXU(R.u))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-ventas-list"]],standalone:!0,features:[e.aNF],decls:11,vars:11,consts:[["ventaForm","ngForm"],[1,"user-container"],["class","message",3,"ngClass",4,"ngIf"],[1,"mini-menu"],["href","#",1,"tab-button",3,"click"],["class","content",4,"ngIf"],[1,"message",3,"ngClass"],[1,"content"],[1,"table-wrapper"],[1,"table-container"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],["class","users-table",4,"ngIf"],["class","no-data",4,"ngIf"],[1,"loading"],[1,"error"],[1,"users-table"],[4,"ngFor","ngForOf"],[1,"status",3,"ngClass"],["type","button",1,"btn-edit",3,"click"],["type","button",1,"btn-invoice",3,"click"],["type","button",1,"btn-delete",3,"click"],[1,"no-data"],[1,"user-form"],[1,"centered-title"],[3,"ngSubmit"],[1,"form-group"],["type","text","name","buscar_cliente","placeholder","Buscar Cliente (C\xe9dula)","size","30%",3,"ngModelChange","input","keyup.enter","blur","ngModel"],["type","button",3,"click"],[1,"form-row"],["type","text","readonly","",3,"value"],["type","email","readonly","",3,"value"],["name","producto_venta",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","number","name","cantidad_producto_venta","step","1","min","1","required","",3,"ngModelChange","ngModel"],[4,"ngIf"],["name","servicio_venta",3,"ngModelChange","ngModel"],["type","number","name","cantidad_servicio_venta","step","1","min","1","required","",3,"ngModelChange","ngModel"],["type","number","name","iva_venta","step","0.01","required","",3,"ngModelChange","ngModel"],["type","number","readonly","",3,"value"],["name","metodo_pago","required","",3,"ngModelChange","ngModel"],["value","efectivo"],["value","tarjeta"],["class","form-row",4,"ngIf"],["type","text","name","vendedor_venta","readonly","",3,"ngModelChange","ngModel"],["type","submit",3,"disabled"],[3,"value"],[1,"addedProductsList"],["type","button",1,"btn-remove",3,"click"],["type","number","name","monto_entregado","step","0.01","min","0","required","",3,"ngModelChange","ngModel"]],template:function(n,o){1&n&&(e.j41(0,"div",1),e.DNE(1,I,2,2,"div",2),e.j41(2,"div",3)(3,"a",4),e.bIt("click",function(l){return l.preventDefault(),o.setActiveTab("list")}),e.EFF(4,"Facturas"),e.k0s(),e.j41(5,"a",4),e.bIt("click",function(l){return l.preventDefault(),o.setActiveTab("new")}),e.EFF(6,"Nueva Venta"),e.k0s(),e.j41(7,"a",4),e.bIt("click",function(l){return l.preventDefault(),o.setActiveTab("edit")}),e.EFF(8,"Editar Venta"),e.k0s()(),e.DNE(9,L,9,4,"section",5)(10,H,100,23,"section",5),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngIf",o.message),e.R7$(2),e.AVh("active","list"===o.activeTab),e.R7$(2),e.AVh("active","new"===o.activeTab),e.R7$(2),e.xc7("display",o.isEditing?"inline-block":"none"),e.AVh("active","edit"===o.activeTab),e.R7$(2),e.Y8G("ngIf","list"===o.activeTab),e.R7$(),e.Y8G("ngIf","new"===o.activeTab||"edit"===o.activeTab))},dependencies:[d.MD,d.YU,d.Sq,d.bT,c.YN,c.qT,c.xH,c.y7,c.me,c.Q0,c.wz,c.BC,c.cb,c.YS,c.VZ,c.vS,c.cV,g.iI],styles:[".user-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}.mini-menu[_ngcontent-%COMP%]{display:flex;border-bottom:2px solid #ddd;margin-bottom:20px}.tab-button[_ngcontent-%COMP%]{padding:10px 20px;text-decoration:none;color:#333;background-color:#f5f5f5;border:1px solid #ddd;border-bottom:none;margin-right:2px;cursor:pointer;transition:all .3s ease}.tab-button[_ngcontent-%COMP%]:hover{background-color:#e9e9e9}.tab-button.active[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px #0000001a}.table-wrapper[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;color:#333}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.users-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:20px}.users-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .users-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid #ddd}.users-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;font-weight:700;color:#333}.users-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.status[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:700;text-transform:uppercase}.status.activo[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.status.inactivo[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.btn-edit[_ngcontent-%COMP%], .btn-delete[_ngcontent-%COMP%]{padding:6px 12px;margin:0 2px;border:none;border-radius:4px;cursor:pointer;font-size:12px;transition:all .3s ease}.btn-edit[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#0056b3}.btn-delete[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#c82333}.btn-remove[_ngcontent-%COMP%]{background-color:#ffc107;color:#212529;border:none;padding:2px 6px;margin-left:10px;border-radius:3px;cursor:pointer;font-size:11px}.btn-remove[_ngcontent-%COMP%]:hover{background-color:#e0a800}.user-form[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.user-form[_ngcontent-%COMP%]   .centered-title[_ngcontent-%COMP%]{text-align:center;color:#333;margin-bottom:30px}.user-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:20px}@media (max-width: 768px){.user-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{flex-direction:column;gap:10px}}.user-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1;position:relative;margin-bottom:20px}.user-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .user-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;font-size:16px;transition:border-color .3s ease}.user-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .user-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff}.user-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[readonly][_ngcontent-%COMP%], .user-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[readonly][_ngcontent-%COMP%]{background-color:#f8f9fa;color:#6c757d}.user-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{position:absolute;top:-8px;left:10px;background-color:#fff;padding:0 5px;font-size:12px;color:#666;font-weight:700}.user-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:10px;padding:10px 15px;background-color:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer;transition:background-color .3s ease}.user-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.user-form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{width:100%;padding:15px;background-color:#28a745;color:#fff;border:none;border-radius:4px;font-size:16px;font-weight:700;cursor:pointer;transition:background-color .3s ease;margin-top:20px}.user-form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#218838}.user-form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed}.addedProductsList[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:4px;padding:15px;margin:10px 0;list-style:none}.addedProductsList[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:8px 0;border-bottom:1px solid #dee2e6;display:flex;justify-content:space-between;align-items:center}.addedProductsList[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.message[_ngcontent-%COMP%]{padding:15px;margin-bottom:20px;border-radius:4px;font-weight:700}.message.success[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724;border:1px solid #c3e6cb}.message.error[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.loading[_ngcontent-%COMP%], .error[_ngcontent-%COMP%], .no-data[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666;font-size:16px}.error[_ngcontent-%COMP%]{color:#dc3545}h3[_ngcontent-%COMP%]{color:#333;margin:20px 0 15px;font-size:18px;border-bottom:2px solid #007bff;padding-bottom:5px}"]})}}return i})()}];let Q=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[d.MD,c.X1,c.YN,g.iI.forChild(J),h.tP,_.Hl,v.m_,f.RG,b.fS,C.Ve,V.hM,M._T,F.Hu,x.D6,E.uc,j.YN]})}}return i})()}}]);